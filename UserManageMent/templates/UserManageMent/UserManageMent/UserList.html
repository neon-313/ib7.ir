{% extends 'Ib7Base.html' %}
{% block content %}
<input type="hidden" id="StateDetail" value="{% url 'instalment_app:StateDetail' %}">
<input type="hidden" id="getuserdata" value="{% url 'UserManageMentUrl:UserManageMent' %}">
<div class="container-xxl flex-grow-1 container-p-y">
  <!-- Layout Demo -->
  <br>
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb breadcrumb-style2 mb-0">
      <li class="breadcrumb-item">
        <a href="javascript:void(0);">خانه</a>
      </li>
      <li class="breadcrumb-item">
        <a href="javascript:void(0);">لیست کاربران</a>
      </li>

    </ol>
  </nav>
  <br>

  <div class="modal fade" id="CreateUser" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-simple modal-edit-user">
      <div class="modal-content p-3 p-md-5">
        <div class="modal-body">
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          <div class="text-center mb-4 mt-0 mt-md-n2">
            <h3 class="secondary-font">ثبت کاربر جدید</h3>
          </div>
          <form id="CreateUserForm" class="row g-3" action="{% url 'UserManageMentUrl:UserManageMent' %}">


            <div class="col-12 col-md-6">
              <label class="form-label" for="modalEditUserFirstName">نام</label>
              <input type="text" id="modalEditUserFirstName" name="first_name" class="form-control" placeholder="نام">
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label" for="modalEditUserLastName">نام خانوادگی</label>
              <input type="text" id="modalEditUserLastName" name="last_name" class="form-control"
                placeholder="نام خانوادگی">
            </div>
            <div class="col-12">
              <label class="form-label" for="modalEditUserName">نام کاربری</label>
              <input type="text" id="modalEditUserName" name="username" required class="form-control text-start"
                placeholder="نام کاربری" dir="ltr">
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label" for="modalEditUserEmail">استان</label>
              <select id="states" name="state" class="select2 form-select form-select-lg" data-allow-clear="true">
                <option value="fuck" selected>لطفا یک استان را انتخاب کنید</option>
                {% for state in states %}
                <option value="{{state.code}}">{{state.name}}</option>

                {% endfor %}
              </select>
              {% csrf_token %}
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label" for="modalEditUserStatus">شهر</label>
              <select id="cities" name="city" class="select2 form-select form-select-lg" data-allow-clear="true">
                <option value="">لطفا استان خود را انتخاب کنید</option>

              </select>
            </div>
            <div class="col-12 col-md-6">

              <div class="form-password-toggle">
                <label class="form-label" for="basic-default-password12"> رمز عبور </label>
                <div class="input-group">
                  <input type="password" name="password" class="form-control text-start" dir="ltr"
                    id="basic-default-password12" required placeholder="············"
                    aria-describedby="basic-default-password2">
                  <span id="pass" class="input-group-text cursor-pointer"><i class="bx bx-hide"></i></span>
                </div>
              </div>
            </div>
            <div class="col-12 col-md-6">

              <div class="form-password-toggle">
                <label class="form-label" for="basic-default-password12"> تايید رمز عبور</label>
                <div class="input-group">
                  <input type="password" name="confirm_password" class="form-control text-start" dir="ltr"
                    id="basic-default-password12" required placeholder="············"
                    aria-describedby="basic-default-password2">
                  <span id="conf_pass" class="input-group-text cursor-pointer"><i class="bx bx-hide"></i></span>
                </div>
              </div>
            </div>
            <div class="col-12">
              <label class="form-label" for="modalEditUserName">شماره تلفن</label>
              <input type="number" id="modalEditUserName" name="phone" class="form-control text-start"
                placeholder="شماره تلفن" dir="ltr">
            </div>
            <div class="col-12 text-center mt-4">
              <button type="submit" class="btn btn-primary me-sm-3 me-1" id="CreateUserBtn">ثبت</button>
              <button type="reset" class="btn btn-label-secondary" data-bs-dismiss="modal" aria-label="Close">
                انصراف
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="card">

    <div class="card-header ">
      <h5 style="float:right;">لیست کاربران</h5>
      <button class="btn rounded-pill btn-secondary" data-bs-toggle="modal" data-bs-target="#CreateUser"
        style="float:left;">ایجاد مورد جدید <i class='bx bx-user-plus bx-tada'></i></button>
    </div>

    <div class="card-datatable text-nowrap">
      <table class="dt-scrollableTable table table-bordered">
        <thead>
          <tr>
            <th>شناسه</th>
            <th>نام</th>
            <th>نام خانوادگی</th>
            <th>شماره تلفن</th>


            <th>تاریخ ثبت نام</th>
            <th>رمز عبور</th>
            <th>استان</th>
            <th>شهر</th>

            
            <th>نام کاربری</th>

            <th>عمل</th>
          </tr>
        </thead>
      </table>
    </div>
  </div>
  <!--/ Layout Demo -->
</div>

{% for user in users %}
<div class="modal fade" id="EditUser_{{user.id}}" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-simple modal-edit-user">
    <div class="modal-content p-3 p-md-5">
      <div class="modal-body">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        <div class="text-center mb-4 mt-0 mt-md-n2">
          <h3 class="secondary-font">ثبت کاربر جدید</h3>
        </div>
        <form id="EditUserForm_{{user.id}}" class="row g-3"
          action="{% url 'UserManageMentUrl:UserManageMent' user.id %}">
          <div class="col-12 col-md-6">
            <label class="form-label" for="modalEditUserFirstName">نام</label>
            <input type="text" id="modalEditUserFirstName" name="first_name" value="{{user.first_name}}"
              class="form-control" placeholder="نام">
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label" for="modalEditUserLastName">نام خانوادگی</label>
            <input type="text" id="modalEditUserLastName" name="last_name" class="form-control"
              value="{{user.last_name}}" placeholder="نام خانوادگی">
          </div>
          <div class="col-12">
            <label class="form-label" for="modalEditUserName">نام کاربری</label>
            <input type="text" id="modalEditUserName" name="username" required class="form-control text-start"
              value="{{user.username}}" placeholder="نام کاربری" dir="ltr">
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label" for="modalEditUserEmail">استان</label>
            <select id="states_{{user.id}}" name="state" onchange="state_edit({{user.id}})"
              class="select2 form-select form-select-lg" data-allow-clear="true">
              <option value="fuck" selected>لطفا یک استان را انتخاب کنید</option>
              {% for state in states %}
              {% if user.state == state.code %}

              <option selected value="{{state.code}}">{{state.name}}</option>
              {% else %}
              <option value="{{state.code}}">{{state.name}}</option>

              {% endif %}

              {% endfor %}
            </select>
            {% csrf_token %}
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label" for="modalEditUserStatus">شهر</label>
            <select id="cities_{{user.id}}" name="city" class="select2 form-select form-select-lg"
              data-allow-clear="true">
              <option value="{{user.city}}" selected>{{user.get_city}}</option>

            </select>
          </div>

          <div class="col-12">
            <label class="form-label" for="modalEditUserName">شماره تلفن</label>
            <input type="number" id="modalEditUserName" value="{{user.phone}}" name="phone"
              class="form-control text-start" placeholder="شماره تلفن" dir="ltr">
          </div>
          <div class="col-12 text-center mt-4">
            <button type="button" class="btn btn-primary me-sm-3 me-1" id="EditUserBtn_{{user.id}}"
              onclick="EditUser({{user.id}})">ثبت</button>
            <button type="reset" class="btn btn-label-secondary" data-bs-dismiss="modal" aria-label="Close">
              انصراف
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endfor %}
{% for user in users %}
<div class="modal fade" id="ChangePassword_{{user.id}}" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-simple modal-edit-user">
    <div class="modal-content p-3 p-md-5">
      <div class="modal-body">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        <div class="text-center mb-4 mt-0 mt-md-n2">
          <h3 class="secondary-font">تغییر رمز عبور {{user.first_name}} {{user.last_name}}</h3>
        </div>
        <form id="ChangePasswordForm_{{user.id}}" class="row g-3"
          action="{% url 'UserManageMentUrl:ChangePsswordUser' user.id %}">
          <div class="col-12 col-md-6">

            <div class="form-password-toggle">
              <label class="form-label" for="basic-default-password12"> رمز عبور </label>
              <div class="input-group">
                <input type="password" name="password" class="form-control text-start" dir="ltr"
                  id="basic-default-password12" required placeholder="············"
                  aria-describedby="basic-default-password2">
                <span id="pass" class="input-group-text cursor-pointer"><i class="bx bx-hide"></i></span>
              </div>
            </div>
          </div>
          <div class="col-12 col-md-6">

            <div class="form-password-toggle">
              <label class="form-label" for="basic-default-password12"> تايید رمز عبور</label>
              <div class="input-group">
                <input type="password" name="confirm_password" class="form-control text-start" dir="ltr"
                  id="basic-default-password12" required placeholder="············"
                  aria-describedby="basic-default-password2">
                <span id="conf_pass" class="input-group-text cursor-pointer"><i class="bx bx-hide"></i></span>
              </div>
            </div>
          </div>
          <div class="col-12 text-center mt-4">
            <button type="button" class="btn btn-primary me-sm-3 me-1" id="ChangePasswordBtn_{{user.id}}"
              onclick="ChangePassword({{user.id}})">ثبت</button>
            <button type="reset" class="btn btn-label-secondary" data-bs-dismiss="modal" aria-label="Close">
              انصراف
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endfor %}
{% comment %} {% for user in user_perms %}
  
<div class="modal fade" id="UserPermission_{{user.id}}" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-simple modal-edit-user">
    <div class="modal-content p-3 p-md-5">
      <div class="modal-body">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        <div class="text-center mb-4 mt-0 mt-md-n2">
          <h3 class="secondary-font">تغییر سطح دسترسی</h3>
        </div>
        <form id="UserPermissionForm_{{user.id}}" class="row g-3"
          action="{% url 'UserManageMentUrl:ChangePsswordUser' user.id %}">
          <div class="table-responsive">
            <table class="table table-striped table-borderless">
              <thead>
                <tr>
                  <th class="text-nowrap">قسمت</th>
                  <th class="text-nowrap text-center">لیست</th>
                  <th class="text-nowrap text-center">ساخت</th>
                  <th class="text-nowrap text-center">ادیت</th>
                  <th class="text-nowrap text-center">حذف</th>
                </tr>
              </thead>
              <tbody>
                {% for g_per in  user.permissions %}
                <tr>
                  <td class="text-nowrap"> {{g_per.permission_name}}</td>
                  <td>
                    <div class="form-check d-flex justify-content-center align-items-center mb-0">
                      {% if  g_per.read %}
                      <input type="checkbox" checked class="form-check-input mt-0" onchange="ChangePermission('{{g_per.permission_name}}','{{user.id}}','read',this)" id="{{g_per.permission_name}}_{{user.id}}_read" name="{{g_per.permission_name}}read">
                      {% else %}
                      <input type="checkbox"  class="form-check-input mt-0" onchange="ChangePermission('{{g_per.permission_name}}','{{user.id}}','read',this)" id="{{g_per.permission_name}}_{{user.id}}_read" name="{{g_per.permission_name}}read">
                      {% endif %}
                    </div>
                  </td>
                  <td>
                    <div class="form-check d-flex justify-content-center align-items-center mb-0">
                      {% if g_per.create %}
                      <input type="checkbox" checked class="form-check-input mt-0" onchange="ChangePermission('{{g_per.permission_name}}','{{user.id}}','create',this)" id="{{g_per.permission_name}}_{{user.id}}_create" name="create">
                      {% else %}
                      <input type="checkbox"  class="form-check-input mt-0" onchange="ChangePermission('{{g_per.permission_name}}','{{user.id}}','create',this)" id="{{g_per.permission_name}}_{{user.id}}_create" name="create">
                      {% endif %}
                    
                    </div>
                  </td>
                  <td>
                    <div class="form-check d-flex justify-content-center align-items-center mb-0">
                      {% if g_per.edit %}
                      <input type="checkbox" checked class="form-check-input mt-0" onchange="ChangePermission('{{g_per.permission_name}}','{{user.id}}','edit',this)" id="{{g_per.permission_name}}_{{user.id}}_edit"      name="edit">
                      {% else %}
                      <input type="checkbox"  class="form-check-input mt-0" onchange="ChangePermission('{{g_per.permission_name}}','{{user.id}}','edit',this)"   id="{{g_per.permission_name}}_{{user.id}}_edit"     name="edit">
                      {% endif %}
                   
                    </div>
                  </td>
                  <td>
                    <div class="form-check d-flex justify-content-center align-items-center mb-0">
                      {% if g_per.delete %}
                      <input type="checkbox" checked class="form-check-input mt-0" onchange="ChangePermission('{{g_per.permission_name}}','{{user.id}}','delete',this)" id="{{g_per.permission_name}}_{{user.id}}_delete" name="delete">
                      {% else %}
                      <input type="checkbox"  class="form-check-input mt-0" onchange="ChangePermission('{{g_per.permission_name}}','{{user.id}}','delete',this)" id="{{g_per.permission_name}}_{{user.id}}_delete" name="delete">
                      {% endif %}
    
                    </div>
                  </td>
                </tr>
                {% endfor %}
      
              </tbody>
            </table>
          </div>
          <div class="col-12 text-center mt-4">
            <button type="button" class="btn btn-primary me-sm-3 me-1" id="UserPermissionBtn_{{user.id}}"
              onclick="ChangePassword({{user.id}})">ثبت</button>
            <button type="reset" class="btn btn-label-secondary" data-bs-dismiss="modal" aria-label="Close">
              انصراف
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endfor %} {% endcomment %}


{% endblock content %}

{% block css %}
{% load static %}
<link rel="stylesheet" href="{% static 'frest_temp/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css' %}">
<link rel="stylesheet" href="{% static 'frest_temp/vendor/libs/datatables-bs5/datatables.bootstrap5.css' %}">
<link rel="stylesheet" href="{% static 'frest_temp/vendor/libs/datatables-select-bs5/select.bootstrap5.css' %}">
<link rel="stylesheet"
  href="{% static 'frest_temp/vendor/libs/datatables-checkboxes-jquery/datatables.checkboxes.css' %}">
<link rel="stylesheet"
  href="{% static 'frest_temp/vendor/libs/datatables-fixedcolumns-bs5/fixedcolumns.bootstrap5.css' %}">
<link rel="stylesheet"
  href="{% static 'frest_temp/vendor/libs/datatables-fixedheader-bs5/fixedheader.bootstrap5.css' %}">
<link rel="stylesheet" href="{% static 'frest_temp/vendor/libs/animate-css/animate.css' %}">

<link rel="stylesheet" href="{% static 'frest_temp/vendor/libs/select2/select2.css' %}">
<link rel="stylesheet" href="{% static 'frest_temp/vendor/libs/tagify/tagify.css' %}">
<link rel="stylesheet" href="{% static 'frest_temp/vendor/libs/bootstrap-select/bootstrap-select.css' %}">
<link rel="stylesheet" href="{% static 'frest_temp/vendor/libs/sweetalert2/sweetalert2.css' %}">
{% endblock css %}
{% block page_js %}
{% load static %}
<!-- begin page js -->
<script src="{% static 'frest_temp/ProductiveJs/UserMangeMent/UserList.js' %}"></script>
<!-- page js -->

<script src="{% static 'frest_temp/js/ui-modals.js' %}"></script>
<script src="{% static 'frest_temp/js/forms-selects.js' %}"></script>
<script src="{% static 'frest_temp/js/forms-tagify.js' %}"></script>
<script src="{% static 'frest_temp/js/forms-typeahead.js' %}"></script>

<script src="{% static 'frest_temp/vendor/libs/select2/select2.js' %}"></script>
<script src="{% static 'frest_temp/vendor/libs/select2/i18n/fa.js' %}"></script>
<script src="{% static 'frest_temp/vendor/libs/tagify/tagify.js' %}"></script>
<script src="{% static 'frest_temp/vendor/libs/bootstrap-select/bootstrap-select.js' %}"></script>
<script src="{% static 'frest_temp/vendor/libs/bootstrap-select/i18n/defaults-fa_IR.js' %}"></script>
<script src="{% static 'frest_temp/vendor/libs/bloodhound/bloodhound.js' %}"></script>
<script src="{% static 'frest_temp/js/extended-ui-sweetalert2.js' %}"></script>
{% endblock page_js %}
{% block vendors %}
{% load static %}
<script src="{% static 'frest_temp/vendor/libs/datatables/i18n/fa.js' %}"></script>
<script src="{% static 'frest_temp/vendor/libs/datatables-bs5/datatables-bootstrap5.js' %}"></script>
<script src="{% static 'frest_temp/vendor/libs/datatables/jquery.dataTables.js' %}"></script>
<script src="{% static 'frest_temp/vendor/libs/datatables-responsive/datatables.responsive.js' %}"></script>
<script src="{% static 'frest_temp/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.js' %}"></script>
<script src="{% static 'frest_temp/vendor/libs/datatables-fixedcolumns/datatables.fixedcolumns.js' %}"></script>
<script src="{% static 'frest_temp/vendor/libs/datatables-fixedheader-bs5/fixedheader.bootstrap5.js' %}"></script>
<script src="{% static 'frest_temp/vendor/libs/datatables-select/datatables-select.js' %}"></script>
<script src="{% static 'frest_temp/vendor/libs/datatables-select-bs5/select.bootstrap5.js' %}"></script>
<script src="{% static 'frest_temp/vendor/libs/datatables-checkboxes-jquery/datatables.checkboxes.js' %}"></script>
<script src="{% static 'frest_temp/vendor/libs/sweetalert2/sweetalert2.js' %}"></script>
{% endblock vendors %}